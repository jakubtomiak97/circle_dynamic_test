version: 2.1
setup: true
orbs:
  path-filtering: circleci/path-filtering@0.1.3
  continuation: circleci/continuation@0.2.0
workflows:
  run-requierd-builds:
    jobs:
      - path-filtering/filter:
          base-revision: << pipeline.git.branch >>
          mapping: |
            apps/app1/.* app1 true
            apps/app2/.* app2 true
            apps/app3/.* app3 true
            .circleci/.* trigger-all true 
      - continuation/continue:
          configuration_path: ".circleci/workflows.yml"
          parameters: /home/circleci/params.json
          pre-steps:
            - run:
                command: |
                  if [ -z "${CIRCLE_PULL_REQUEST##*/}" ]
                  then
                    IS_PR=false
                  else
                    IS_PR=true
                  fi
                  echo '{ "is_pr": '$IS_PR' }' >> /home/circleci/params.json




